<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Kubewarden 1.17 release</title><link rel=icon type=image/svg href=/favicon.svg><link rel=mask-icon href=/favicon.svg><link rel=stylesheet type=text/css href=/sass/blog.min.css?1733740616><script async defer src=https://buttons.github.io/buttons.js></script><script type=text/javascript src=//cdn.bizible.com/scripts/bizible.js async></script></head><body><header><div class=sub-header><a href><img src=/images/logo-kubewarden.svg alt=Kubewarden></a>
<a href=#main-menu id=main-menu-toggle class=menu-toggle aria-label="Open main menu"><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a><nav id=main-menu class=main-menu aria-label="Main menu"><a href=#main-menu-toggle id=main-menu-close class=menu-close aria-label="Close main menu"><span class=sr-only>Close main menu</span>
<span class="fa fa-close" aria-hidden=true></span></a><h2 id=main-menu-heading class=sr-only>Main menu</h2><ul class=menu><li><a href="https://artifacthub.io/packages/search?kind=13&sort=relevance&page=1" target=_blank class="btn no-bg">Policies</a></li><li><a href=https://charts.kubewarden.io/ target=_blank class="btn no-bg">Helm Charts</a></li><li><a href=https://docs.kubewarden.io/ target=_blank class="btn no-bg">Docs</a></li><li><a href="https://kubernetes.slack.com/?redir=%2Fmessages%2Fkubewarden" target=_blank class="btn no-bg">Slack</a></li><li><a href=https://twitter.com/kubewarden target=_blank class="btn no-bg">Twitter</a></li><li><a href=/#get-in-touch target=_blank class="btn no-bg">Community</a></li><li><a href=/blog target=_blank class="btn no-bg">Blog</a></li><li><a href=https://github.com/kubewarden class="btn github"><img src=/images/icon-github.svg><span>Github</span></a></li></ul></nav><a href=#main-menu-toggle class=backdrop tabindex=-1 aria-hidden=true hidden></a></div></header><link rel=stylesheet href=/css/blog.css><section class=intro><div class=bg-primary><div class="wrap grid-one"><div><h1 style=color:#fff><a href=/blog>The Kubewarden blog</a>
<a href=/blog/index.xml><img src=/images/icon-rss.svg class=fill-white height=20></a></h1></div></div></div></section><main><section class=wrap><article><h1>Kubewarden 1.17 release</h1><p>Author: <author>VÃ­ctor Cuadrado Juan</author></p><p>Published: <time>30 Sep 2024</time></p><p>Updated: <time>09 Dec 2024</time></p><div id=blog-post-content><p>We are thrilled to announce the release of Kubewarden v1.17.0. This release is
packed with big features, let&rsquo;s have a look!</p><h2 id=certificate-rotation--removal-of-cert-manager-dependency>Certificate rotation & removal of cert-manager dependency</h2><p>Starting from this release, the Kubewarden stack takes care of creating and
rotating all the needed TLS certificates and certificate authorities.</p><p>Kubewarden, by virtue of connecting to the Kubernetes API server, needs TLS
certificates for both the kubewarden-controller (when creating webhooks for its
policies) and for the PolicyServers (so they can report their results to the
Webhook API server).</p><p>Up until v1.16, the certificate authority (CA) and leaf certificates used by
kubewarden-controller to connect to the Webhooks API were generated by
cert-manager.
The certificates used to register our PolicyServers with the Kubernetes Webhook
API were, and continue to be, generated by our controller. Our controller
generates a self-signed Certificate Authority that is used to sign all the
PolicyServer certificates. These had a 10 year expiration date. Certificate rotation
for all these was left to the user.</p><p>From v1.17 onwards, we generate the CA and certificate on Helm install or
upgrade if not present, under <code>kubewarden-ca</code> Secret. This means we don&rsquo;t
depend on cert-manager anymore. The CA defaults to a 10 year expiration date,
and the leaf certificates to a 1 year expiration date.</p><p>In addition, now the kubewarden-controller rotates both the CA and the needed
certificates for the webhooks and PolicyServers on its own, 1 month before the
expiration date. Care is taken to ensure a valid overlap of old and new
certificates, and removal of old certificates as soon as possible for security
reasons.</p><p>So, cert-manager can now be removed if it was installed as a dependency of
Kubewarden. It can be left installed if it is being used for other workloads.</p><p>The v1.17 Helm chart also contains post-install and post-upgrade hooks to
perform the needed cleanups of leftover Secrets (<code>webhook-secret-cert</code>, now
<code>kubewarden-webhook-secret-cert</code>) when upgrading to v1.17.</p><h2 id=new-policy-types-policy-groups>New policy types: Policy Groups</h2><p>Starting from V1.17, the Kubewarden stack now supports 2 new Kubernetes Custom
Resources:</p><ul><li><strong>AdmissionPolicyGroups</strong>: Namespaced policy comprised of several policies.</li><li><strong>ClusterAdmissionPolicyGroups</strong>: Clusterwide policy comprised of several policies.</li></ul><p>These new Policy Groups resources define a policy comprised of several policies and
their policy settings, and they perform a combined evaluation of those multiple
policies using logical operators.</p><p>This reuses existing policies, reducing the need for custom policy creation,
and providing complex logic while at the same time reducing complexity (thanks
to using existing policies, or for example using CEL via the <a href=https://artifacthub.io/packages/kubewarden/cel-policy/cel-policy>cel-policy</a>).</p><p>However, while ordinary policies can include mutation logic to modify resources
during admission, policy groups are limited to validation only.</p><p>Configuration for policy groups is similar to that of ordinary policies. The
difference is the addition of the <code>expression</code>, <code>message</code>, and <code>policies</code> fields, as
well as the declaration of context-aware rules in a different location.</p><p>Here is an example of a ClusterAdmissionPolicyGroup that makes sure a Service
selector is unique or owned by a specific team:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>---
<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>policies.kubewarden.io/v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterAdmissionPolicyGroup</span> <span style=color:#75715e># or AdmissionPolicyGroup</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>unique-service-selector</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>rules</span>:
    - <span style=color:#f92672>apiGroups</span>: [<span style=color:#e6db74>&#34;&#34;</span>]
      <span style=color:#f92672>apiVersions</span>: [<span style=color:#e6db74>&#34;v1&#34;</span>]
      <span style=color:#f92672>resources</span>: [<span style=color:#e6db74>&#34;services&#34;</span>]
      <span style=color:#f92672>operations</span>: [<span style=color:#e6db74>&#34;CREATE&#34;</span>, <span style=color:#e6db74>&#34;UPDATE&#34;</span>]
  <span style=color:#f92672>policies</span>:
    <span style=color:#f92672>unique_service_selector</span>:
      <span style=color:#f92672>module</span>: <span style=color:#ae81ff>registry://ghcr.io/kubewarden/policies/unique-service-selector-policy:v0.1.0</span>
      <span style=color:#f92672>contextAwareResources</span>:
        - <span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
          <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
      <span style=color:#f92672>settings</span>:
        <span style=color:#f92672>app.kubernetes.io/name</span>: <span style=color:#ae81ff>MyApp</span>
    <span style=color:#f92672>owned_by_foo_team</span>:
      <span style=color:#f92672>module</span>: <span style=color:#ae81ff>registry://ghcr.io/kubewarden/policies/safe-annotations:v0.2.9</span>
      <span style=color:#f92672>settings</span>:
        <span style=color:#f92672>mandatory_annotations</span>:
          - <span style=color:#ae81ff>owner</span>
        <span style=color:#f92672>constrained_annotations</span>:
          <span style=color:#f92672>owner</span>: <span style=color:#e6db74>&#34;foo-team&#34;</span>
  <span style=color:#f92672>expression</span>: <span style=color:#e6db74>&#34;unique_service_selector() || (!unique_service_selector() &amp;&amp; owned_by_foo_team())&#34;</span>
  <span style=color:#f92672>message</span>: <span style=color:#e6db74>&#34;the service selector is not unique or the service is not owned by the foo team&#34;</span>
</code></pre></div><p>As usual, the CRDs are documented in our
<a href=https://docs.kubewarden.io/reference/CRDs#resource-types>reference</a> docs. And
you can read their
<a href=https://docs.kubewarden.io/explanations/policy-groups>explanation</a> and an
in-depth <a href=https://docs.kubewarden.io/next/howtos/policy-groups>how-to</a> on the
docs for these resources.</p><p>Stay tuned for a new deep dive blog post!</p><h2 id=policy-updates>Policy updates</h2><p>During this development cycle, we have updated the following policies maintained by us.</p><h3 id=cel-policy>cel-policy</h3><p>The <a href=https://artifacthub.io/packages/kubewarden/cel-policy/cel-policy>cel-policy</a>,
is our policy that bundles and extends Kubernetes' cel-go library, got some nice
additions:</p><ul><li>Enabled lazy evaluation for variables.</li><li>Bumped cel-go library to <a href=https://github.com/google/cel-go/releases/tag/v0.21.0>v0.21.0</a>:
This allows us to consume nifty things like math extensions for bitwise ops
and floats, better support for custom types and type registries, improved
nested rules and variables, between others.</li><li>We automated all bumps of cel-go, k8s.io/apiserver, and other libraries,
thanks to <a href=https://www.updatecli.io/>updatecli</a>.</li></ul><h3 id=verify-image-signatures>verify-image-signatures</h3><p>The <a href=https://artifacthub.io/packages/kubewarden/verify-image-signatures/verify-image-signatures>verify-image-signatures</a>
policy now allows mutation of all the workload resources associated with it.</p><h3 id=trusted-repos-policy>trusted-repos-policy</h3><p>Quite the list of changes for this policy with a big refactor for maintenance.
This includes:</p><ul><li>Added support for all workload resource types other than Pod.</li><li>Move to the <code>oci-spec</code> crate to parse OCI references and drop our custom
parsing. This also adds settings validation for images, registries, and tags
that are not compliant with the OCI spec.</li><li>Detect the implicit <code>latest</code> tag.</li><li>Increase test coverage to almost 100%, and introduce end-to-end tests.</li></ul><h2 id=getting-in-touch>Getting in touch</h2><p>As always, you can contact us through <a href="https://kubernetes.slack.com/?redir=%2Fmessages%2Fkubewarden">Slack</a> and
<a href=https://github.com/orgs/kubewarden/discussions>GitHub discussions</a>.</p></div><div><ul id=tags></ul></div><div></div></article></section></main><footer><p>&copy; 2024 Kubewarden Project Authors. All rights reserved.
The Linux Foundation has registered trademarks and uses trademarks.
For a list of trademarks of The Linux Foundation, please see our Trademark Usage page:
<a href=https://www.linuxfoundation.org/trademark-usage>https://www.linuxfoundation.org/trademark-usage</a></p></footer><script async src="https://www.googletagmanager.com/gtag/js?id=G-PSW07XK7TM"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-PSW07XK7TM',{anonymize_ip:!0})}</script></body></html>