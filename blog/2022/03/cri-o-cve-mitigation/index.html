<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>CRI-O CVE-2022-0811 Mitigation</title><link rel=icon type=image/svg href=/favicon.svg><link rel=mask-icon href=/favicon.svg><link rel=stylesheet type=text/css href=/sass/blog.min.css?1717678997><script async defer src=https://buttons.github.io/buttons.js></script><script type=text/javascript src=//cdn.bizible.com/scripts/bizible.js async></script></head><body><header><div class=sub-header><a href><img src=/images/logo-kubewarden.svg alt=Kubewarden></a>
<a href=#main-menu id=main-menu-toggle class=menu-toggle aria-label="Open main menu"><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a><nav id=main-menu class=main-menu aria-label="Main menu"><a href=#main-menu-toggle id=main-menu-close class=menu-close aria-label="Close main menu"><span class=sr-only>Close main menu</span>
<span class="fa fa-close" aria-hidden=true></span></a><h2 id=main-menu-heading class=sr-only>Main menu</h2><ul class=menu><li><a href="https://artifacthub.io/packages/search?kind=13&sort=relevance&page=1" target=_blank class="btn no-bg">Policies</a></li><li><a href=https://charts.kubewarden.io/ target=_blank class="btn no-bg">Helm Charts</a></li><li><a href=https://docs.kubewarden.io/ target=_blank class="btn no-bg">Docs</a></li><li><a href="https://kubernetes.slack.com/?redir=%2Fmessages%2Fkubewarden" target=_blank class="btn no-bg">Slack</a></li><li><a href=https://twitter.com/kubewarden target=_blank class="btn no-bg">Twitter</a></li><li><a href=/blog target=_blank class="btn no-bg">Blog</a></li><li><a href=https://github.com/kubewarden class="btn github"><img src=/images/icon-github.svg><span>Github</span></a></li></ul></nav><a href=#main-menu-toggle class=backdrop tabindex=-1 aria-hidden=true hidden></a></div></header><link rel=stylesheet href=/css/blog.css><section class=intro><div class=bg-primary><div class="wrap grid-one"><div><h1 style=color:#fff><a href=/blog>The Kubewarden blog</a>
<a href=/blog/index.xml><img src=/images/icon-rss.svg class=fill-white height=20></a></h1></div></div></div></section><main><section class=wrap><article><h1>CRI-O CVE-2022-0811 Mitigation</h1><p>Author: <author>Jos√© Guilherme Vanz</author></p><p>Published: <time>29 Mar 2022</time></p><p>Updated: <time>06 Jun 2024</time></p><div id=blog-post-content><p>Recently a severe <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0811">CVE</a>
in the CRI-O container engine come to public. The flaw in CRI-O allows bad
actors to gain root access and run arbitrary code in the host machine.</p><p>A <a href=https://github.com/cri-o/cri-o/releases/tag/v1.23.2>fix</a> for the issue is
already available and you should update your cluster to avoid any headache in
the future. But if you cannot do that right away, use Kubewarden to mitigate the impact of
this issue. It&rsquo;s possible to prevent pods with <code>sysctl</code> configuration
to run in the cluster with the policy <code>sysctl-psp</code> available in the <a href=https://hub.kubewarden.io/>Policy
Hub</a>.</p><p>The policy configuration to block all sysctl-related configuration for a pod is detailed below:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>policies.kubewarden.io/v1alpha2</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterAdmissionPolicy</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mitigate-crio-cve</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>module</span>: <span style=color:#ae81ff>registry://ghcr.io/kubewarden/policies/sysctl-psp:v0.1.7</span>
  <span style=color:#f92672>rules</span>:
  - <span style=color:#f92672>apiGroups</span>: [<span style=color:#e6db74>&#34;&#34;</span>]
    <span style=color:#f92672>apiVersions</span>: [<span style=color:#e6db74>&#34;v1&#34;</span>]
    <span style=color:#f92672>resources</span>: [<span style=color:#e6db74>&#34;pods&#34;</span>]
    <span style=color:#f92672>operations</span>:
    - <span style=color:#ae81ff>CREATE</span>
    - <span style=color:#ae81ff>UPDATE</span>
  <span style=color:#f92672>mutating</span>: <span style=color:#66d9ef>false</span>
  <span style=color:#f92672>settings</span>:
    <span style=color:#f92672>forbiddenSysctls</span>:
    - <span style=color:#e6db74>&#34;*&#34;</span>
</code></pre></div><p>This will not allow pods that have kernel parameters defined to run. It&rsquo;s important to
remember that this is <strong>not</strong> a fix for the issue, but a temporary mitigation. You must update your CRI-O version as
soon as possible.</p><p>You can test the solution using the pod definition from <a href=https://sysdig.com/blog/cve-2022-0811-cri-o/>this Sysdig blogpost</a>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sysctl-set</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>securityContext</span>:
   <span style=color:#f92672>sysctls</span>:
   - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kernel.shm_rmid_forced</span>
     <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;1+kernel.core_pattern=|/var/lib/containers/storage/overlay/3ef1281bce79865599f673b476957be73f994d17c15109d2b6a426711cf753e6/diff/malicious.sh #&#34;</span>
  <span style=color:#f92672>containers</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>alpine</span>
    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>alpine:latest</span>

</code></pre></div><p>Once the<code>sysctl-psp</code> policy is running, you will not be able to deploy the pod.</p></div><div><ul id=tags></ul></div><div></div></article></section></main><footer><p>&copy; 2024 Kubewarden Project Authors. All rights reserved.
The Linux Foundation has registered trademarks and uses trademarks.
For a list of trademarks of The Linux Foundation, please see our Trademark Usage page:
<a href=https://www.linuxfoundation.org/trademark-usage>https://www.linuxfoundation.org/trademark-usage</a></p><div class=project-icons><a href=https://k3s.io target=blank><img src=/images/icon-k3s.svg height=20></a>
<a href=https://harvesterhci.io target=blank><img src=/images/icon-harvester.svg height=20></a>
<a href=https://rancherdesktop.io target=blank><img src=/images/icon-rancher-desktop.svg height=20></a>
<a href=https://epinio.io target=blank><img src=/images/icon-epinio.svg height=20></a>
<a href=https://hypper.io target=blank><img src=/images/icon-hypper.svg height=20></a></div></footer><script async src="https://www.googletagmanager.com/gtag/js?id=G-PSW07XK7TM"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-PSW07XK7TM',{anonymize_ip:!0})}</script></body></html>