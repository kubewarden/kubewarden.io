<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Secure Supply Chain: Verifying image signatures</title><link rel=icon type=image/svg href=/favicon.svg><link rel=mask-icon href=/favicon.svg><link rel=stylesheet type=text/css href=/sass/blog.min.css?1738228402><script async defer src=https://buttons.github.io/buttons.js></script><script type=text/javascript src=//cdn.bizible.com/scripts/bizible.js async></script></head><body><header><div class=sub-header><a href><img src=/images/logo-kubewarden.svg alt=Kubewarden></a>
<a href=#main-menu id=main-menu-toggle class=menu-toggle aria-label="Open main menu"><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a><nav id=main-menu class=main-menu aria-label="Main menu"><a href=#main-menu-toggle id=main-menu-close class=menu-close aria-label="Close main menu"><span class=sr-only>Close main menu</span>
<span class="fa fa-close" aria-hidden=true></span></a><h2 id=main-menu-heading class=sr-only>Main menu</h2><ul class=menu><li><a href="https://artifacthub.io/packages/search?kind=13&sort=relevance&page=1" target=_blank class="btn no-bg">Policies</a></li><li><a href=https://charts.kubewarden.io/ target=_blank class="btn no-bg">Helm Charts</a></li><li><a href=https://docs.kubewarden.io/ target=_blank class="btn no-bg">Docs</a></li><li><a href="https://kubernetes.slack.com/?redir=%2Fmessages%2Fkubewarden" target=_blank class="btn no-bg">Slack</a></li><li><a href=https://bsky.app/profile/kubewarden.io target=_blank class="btn no-bg">Bluesky</a></li><li><a href=https://hachyderm.io/@kubewarden rel=me target=_blank class="btn no-bg">Mastodon</a></li><li><a href=/#get-in-touch target=_blank class="btn no-bg">Community</a></li><li><a href=/blog target=_blank class="btn no-bg">Blog</a></li><li><a href=https://github.com/kubewarden class="btn github"><img src=/images/icon-github.svg><span>Github</span></a></li></ul></nav><a href=#main-menu-toggle class=backdrop tabindex=-1 aria-hidden=true hidden></a></div></header><link rel=stylesheet href=/css/blog.css><section class=intro><div class=bg-primary><div class="wrap grid-one"><div><h1 style=color:#fff><a href=/blog>The Kubewarden blog</a>
<a href=/blog/index.xml><img src=/images/icon-rss.svg class=fill-white height=20></a></h1></div></div></div></section><main><section class=wrap><article><h1>Secure Supply Chain: Verifying image signatures</h1><p>Author: <author>Raul Cabello Martin</author></p><p>Published: <time>20 May 2022</time></p><p>Updated: <time>30 Jan 2025</time></p><div id=blog-post-content><p>After these last releases Kubewarden now has support for verifying the integrity and authenticity of artifacts within
Kubewarden using the Sigstore project. In this post, we shall focus on verifying container image signatures using the
new <a href=https://github.com/kubewarden/verify-image-signatures>verify-image-signatures</a> policy.</p><p>To learn more about how Sigstore works, take a look at our
previous <a href=https://www.kubewarden.io/blog/2022/04/securing-kubewarden-policies/>post</a></p><h2 id=verify-image-signatures-policy>Verify Image Signatures Policy</h2><p>This policy validates Pods by checking their container images for signatures (that is, containers, init containers and
ephemeral containers in the pod)</p><p>The policy can inspect all the container images defined inside of a Pod or it can just analyze the ones that
are matching a pattern provided by the user.</p><p>Container image tags are mutable, they can be changed to point to a completely different content. That&rsquo;s why it&rsquo;s a
good security practice to reference container images by their immutable checksum.</p><p>This policy can rewrite the image definitions that are using a tag to instead reference the image by its checksum.</p><p>The policy will:</p><ul><li>Ensure the image referenced by a tag is satisfying the signature requested by the operator</li><li>Extract the immutable reference of the image from the signatures</li><li>Rewrite the image reference to be in the form <code>&lt;image ref>@sha256:&lt;digest></code></li></ul><h2 id=lets-see-it-in-action>Let&rsquo;s see it in action!</h2><p>For this example, a Kubernetes cluster with Kubewarden already installed is required. The installation process is
described in the <a href=https://docs.kubewarden.io/quick-start>quick start guide</a>.</p><p>We need an image with a signature that we can verify. You can use <a href=https://github.com/sigstore/cosign>cosign</a> to sign
your images. For this example we&rsquo;ll use the image
<code>ghcr.io/viccuad/app-example:v0.1.0</code> that was signed using keyless verification.</p><p>Obtain the issuer and subject using cosign.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>COSIGN_EXPERIMENTAL=1 cosign verify ghcr.io/viccuad/app-example:v0.1.0
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>...
&#34;Issuer&#34;: &#34;https://token.actions.githubusercontent.com&#34;,
&#34;Subject&#34;: &#34;https://github.com/viccuad/app-example/.github/workflows/ci.yml@refs/tags/v0.1.0&#34;
...
</code></pre></div><p>Let&rsquo;s create a cluster-wide policy that will verify all images, and
let&rsquo;s use the issuer and subject for verification:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl apply -f - &lt;&lt;EOF
apiVersion: policies.kubewarden.io/v1alpha2
kind: ClusterAdmissionPolicy
metadata:
  name: verify-image-signatures
spec:
  module: ghcr.io/kubewarden/policies/verify-image-signatures:v0.1.4
  rules:
  - apiGroups: [&#34;&#34;]
    apiVersions: [&#34;v1&#34;]
    resources: [&#34;pods&#34;]
    operations:
    - CREATE
    - UPDATE
  mutating: true
  settings:
    signatures:
      - image: &#34;*&#34;
        keyless:
          - issuer: &#34;https://token.actions.githubusercontent.com&#34;
            subject: &#34;https://github.com/viccuad/app-example/.github/workflows/ci.yml@refs/tags/v0.1.0&#34;
EOF
</code></pre></div><p>Wait for the policy to be active:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl wait --for=condition=PolicyActive clusteradmissionpolicies verify-image-signatures
</code></pre></div><p>Verify we can create pods with containers that are signed:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl apply -f - &lt;&lt;EOF
apiVersion: v1
kind: Pod
metadata:
  name: verify-image-valid
spec:
  containers:
  - name: test-verify-image
    image: ghcr.io/viccuad/app-example:v0.1.0
EOF
</code></pre></div><p>Then check that the image was modified with the digest:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl get pod verify-image-valid -o=jsonpath=&#39;{.spec.containers[0].image}&#39;
</code></pre></div><p>This will produce the following output:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>ghcr.io/viccuad/app-example:v0.1.0@sha256:d97d00f668dc5b7f0af65edbff6b37924c8e9b1edfc0ab0f7d2e522cab162d38
</code></pre></div><p>Finally, let&rsquo;s try to create a pod with an image that it is not signed:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl apply -f - &lt;&lt;EOF
apiVersion: v1
kind: Pod
metadata:
  name: verify-image-invalid
spec:
  containers:
  - name: test-verify-image
    image: ghcr.io/kubewarden/test-verify-image-signatures:unsigned
EOF
</code></pre></div><p>We will get the following error:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>Error from server: error when creating &#34;STDIN&#34;: admission webhook &#34;clusterwide-verify-image-signatures.kubewarden.admission&#34; denied the request: Pod verify-image-invalid is not accepted: verification of image ghcr.io/kubewarden/test-verify-image-signatures:unsigned failed: Host error: Callback evaluation failure: no signatures found for image: ghcr.io/kubewarden/test-verify-image-signatures:unsigned 
</code></pre></div><h2 id=recap>Recap</h2><p>This policy is designed to meet all your needs. However, if you prefer you can build your own policy using one of the SDKs Kubewarden
provides. We will show how to do this in an upcoming blog! Stay tuned!</p></div><div><ul id=tags></ul></div><div></div></article></section></main><footer><p>&copy; 2025 Kubewarden Project Authors. All rights reserved.
The Linux Foundation has registered trademarks and uses trademarks.
For a list of trademarks of The Linux Foundation, please see our Trademark Usage page:
<a href=https://www.linuxfoundation.org/trademark-usage>https://www.linuxfoundation.org/trademark-usage</a></p></footer><script async src="https://www.googletagmanager.com/gtag/js?id=G-PSW07XK7TM"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-PSW07XK7TM',{anonymize_ip:!0})}</script></body></html>