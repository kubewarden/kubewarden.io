<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Enforcing compliance of container's environment variables</title><link rel=icon type=image/svg href=/favicon.svg><link rel=mask-icon href=/favicon.svg><link rel=stylesheet type=text/css href=/sass/blog.min.css?1685457418><script async defer src=https://buttons.github.io/buttons.js></script><script type=text/javascript src=//cdn.bizible.com/scripts/bizible.js async></script></head><body><header><div class=sub-header><a href><img src=/images/logo-kubewarden.svg alt=Kubewarden></a>
<a href=#main-menu id=main-menu-toggle class=menu-toggle aria-label="Open main menu"><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a><nav id=main-menu class=main-menu aria-label="Main menu"><a href=#main-menu-toggle id=main-menu-close class=menu-close aria-label="Close main menu"><span class=sr-only>Close main menu</span>
<span class="fa fa-close" aria-hidden=true></span></a><h2 id=main-menu-heading class=sr-only>Main menu</h2><ul class=menu><li><a href="https://artifacthub.io/packages/search?kind=13&sort=relevance&page=1" target=_blank class="btn no-bg">Policies</a></li><li><a href=https://charts.kubewarden.io/ target=_blank class="btn no-bg">Helm Charts</a></li><li><a href=https://docs.kubewarden.io/ target=_blank class="btn no-bg">Docs</a></li><li><a href="https://kubernetes.slack.com/?redir=%2Fmessages%2Fkubewarden" target=_blank class="btn no-bg">Slack</a></li><li><a href=https://twitter.com/kubewarden target=_blank class="btn no-bg">Twitter</a></li><li><a href=/blog target=_blank class="btn no-bg">Blog</a></li><li><a href=https://github.com/kubewarden class="btn github"><img src=/images/icon-github.svg><span>Github</span></a></li></ul></nav><a href=#main-menu-toggle class=backdrop tabindex=-1 aria-hidden=true hidden></a></div></header><link rel=stylesheet href=/css/blog.css><section class=intro><div class=bg-primary><div class="wrap grid-one"><div><h1 style=color:#fff><a href=/blog>The Kubewarden blog</a>
<a href=/blog/index.xml><img src=/images/icon-rss.svg class=fill-white height=20></a></h1></div></div></div></section><main><section class=wrap><article><h1>Enforcing compliance of container's environment variables</h1><p>Author: <author>Jos√© Guilherme Vanz</author></p><p>Published: <time>31 Oct 2022</time></p><p>Updated: <time>30 May 2023</time></p><div id=blog-post-content><p>We&rsquo;re glad to present the new <a href=https://github.com/kubewarden/environment-variable-policy>environment-variable-policy</a> to Kubewarden users. With this policy, you will now be able to inspect init containers and ephemeral containers. You can also restrict their usage by reviewing the names and values defined under the containers' <a href=https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#envvar-v1-core><code>env[*]</code></a> field.</p><p>As always, the policy can be found in <a href=https://artifacthub.io/packages/kubewarden/environment-variable-policy/environment-variable-policy>ArtifactHub</a> and all the <a href=https://github.com/kubewarden/environment-variable-policy/releases>artifacts</a>, including the BOM files, are signed with Sigstore.</p><h2 id=what-is-so-useful-about-the-new-environment-variable-policy>What is so useful about the new environment-variable policy?</h2><p>This policy complements the recently released <a href=https://www.kubewarden.io/blog/2022/10/env-var-secrets/>env-variable-secrets-scanner</a> policy. Both policies focus on validating the environment values provided to Kubernetes Pod objects. In this new policy, users can validate which variables name and values their resources can have.</p><p>The policy controls the environment variable defined in the containers using the four operators described in the next sections.</p><h3 id=anyin>anyIn</h3><p><code>anyIn</code> works as a deny list of your usage of environment variables. It checks if any of the <code>environmentVariables</code> are in the Pod/Workload resource:</p><p>For example, given the following configuration:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>settings</span>:
  <span style=color:#f92672>rules</span>:
    - <span style=color:#f92672>reject</span>: <span style=color:#ae81ff>anyIn</span>
      <span style=color:#f92672>environmentVariables</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar&#34;</span>
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo2&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar2&#34;</span>
</code></pre></div><p>The following Pod would be rejected:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.14.2</span>
      <span style=color:#f92672>ports</span>:
      - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
      <span style=color:#f92672>env</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar&#34;</span>
</code></pre></div><p>But the next one would be accepted:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.14.2</span>
      <span style=color:#f92672>ports</span>:
      - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
      <span style=color:#f92672>env</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo3&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar3&#34;</span>
</code></pre></div><h3 id=anynotin>anyNotIn</h3><p><code>anyNotIn</code> works as an allow list. Checks if any of the <code>environmentVariables</code> are not in the Pod/Workload resource:</p><p>For example, given the following configuration:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>settings</span>:
  <span style=color:#f92672>rules</span>:
    - <span style=color:#f92672>reject</span>: <span style=color:#ae81ff>anyNotIn</span>
      <span style=color:#f92672>environmentVariables</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar&#34;</span>
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo2&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar2&#34;</span>
</code></pre></div><p>The following Pod would be rejected:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.14.2</span>
      <span style=color:#f92672>ports</span>:
      - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
      <span style=color:#f92672>env</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar&#34;</span>
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo3&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar3&#34;</span>
</code></pre></div><p>But the next one would be accepted:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.14.2</span>
      <span style=color:#f92672>ports</span>:
      - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
      <span style=color:#f92672>env</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar&#34;</span>
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo2&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar2&#34;</span>
</code></pre></div><h3 id=allareused>allAreUsed</h3><p><code>allAreUsed</code> the container cannot use all listed environment variables at once. Checks if all of the <code>environmentVariables</code> are in the Pod/Workload resource:</p><p>For example, given the following configuration:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>settings</span>:
  <span style=color:#f92672>rules</span>:
    - <span style=color:#f92672>reject</span>: <span style=color:#ae81ff>allAreUsed</span>
      <span style=color:#f92672>environmentVariables</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar&#34;</span>
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo2&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar2&#34;</span>
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo3&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar3&#34;</span>
</code></pre></div><p>The following Pod would be rejected:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.14.2</span>
      <span style=color:#f92672>ports</span>:
      - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
      <span style=color:#f92672>env</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar&#34;</span>
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo2&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar2&#34;</span>
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo3&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar3&#34;</span>
</code></pre></div><p>But the next one would be accepted:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.14.2</span>
      <span style=color:#f92672>ports</span>:
      - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
      <span style=color:#f92672>env</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar&#34;</span>
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo3&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar3&#34;</span>
</code></pre></div><h3 id=notallareused>notAllAreUsed</h3><p><code>notAllAreUsed</code> the container can use all listed environment variables at once. But it cannot has only a subset of them.
Checks if all of the <code>environmentVariables</code> are not in the Pod/Workload resource</p><p>For example, given the following configuration:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>settings</span>:
  <span style=color:#f92672>rules</span>:
    - <span style=color:#f92672>reject</span>: <span style=color:#ae81ff>notAllAreUsed</span>
      <span style=color:#f92672>environmentVariables</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar&#34;</span>
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo2&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar2&#34;</span>
</code></pre></div><p>The following Pod would be rejected:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
  <span style=color:#f92672>spec</span>:
    <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.14.2</span>
      <span style=color:#f92672>ports</span>:
      - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
      <span style=color:#f92672>env</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar&#34;</span>
</code></pre></div><p>But the next one would be accepted:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>nginx:1.14.2</span>
      <span style=color:#f92672>ports</span>:
      - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
      <span style=color:#f92672>env</span>:
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar&#34;</span>
        - <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;foo2&#34;</span>
          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;bar2&#34;</span>
</code></pre></div><h2 id=using-multiple-rules>Using multiple rules</h2><p>The user is allowed to define multiple rules in the policy settings. The resource must be approved by all of them in order to be accepted into the cluster.
Let&rsquo;s take a look in an example. Consider the following rules:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl apply -f - &lt;&lt;EOF
apiVersion: policies.kubewarden.io/v1
kind: ClusterAdmissionPolicy
metadata:
  name: environment-variable-policy
spec:
  module: ghcr.io/kubewarden/policies/environment-variable-policy:v0.1.1
  mutating: false
  rules:
  - apiGroups: [&#34;apps&#34;]
    apiVersions: [&#34;v1&#34;]
    resources: [&#34;deployments&#34;]
    operations:
    - CREATE
    - UPDATE
  settings:
    rules:
      - reject: anyIn
        environmentVariables:
          - name: &#34;foo&#34;
            value: &#34;bar&#34;
          - name: &#34;foo2&#34;
            value: &#34;bar2&#34;
      - reject: allAreUsed
        environmentVariables:
          - name: &#34;foo3&#34;
            value: &#34;bar3&#34;
          - name: &#34;foo4&#34;
            value: &#34;bar4&#34;
EOF
</code></pre></div><p>The following two <code>Deployments</code> will be rejected. The first one will be rejected by the first rule:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl apply -f - &lt;&lt;EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: template-nginx
  template:
    metadata:
      labels:
        app: template-nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
        env:
          - name: &#34;foo&#34;
            value: &#34;bar&#34;
EOF
Error from server: error when creating &#34;STDIN&#34;: admission webhook &#34;clusterwide-environment-variable-policy.kubewarden.admission&#34; denied the request: Resource cannot define any of the environment variables from the rule.
</code></pre></div><p>The second <code>Deployment</code> will be reject by the second rule:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl apply -f - &lt;&lt;EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: template-nginx
  template:
    metadata:
      labels:
        app: template-nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
        env:
          - name: &#34;foo3&#34;
            value: &#34;bar3&#34;
          - name: &#34;foo4&#34;
            value: &#34;bar4&#34;
EOF
Error from server: error when creating &#34;STDIN&#34;: admission webhook &#34;clusterwide-environment-variable-policy.kubewarden.admission&#34; denied the request: Resource cannot have all the environment variables from the rule defined.
</code></pre></div><p>But when we try to deploy a resource that respects both rules, it will be created with no issues:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl apply -f - &lt;&lt;EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: template-nginx
  template:
    metadata:
      labels:
        app: template-nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
        env:
          - name: &#34;foo3&#34;
            value: &#34;bar3&#34;
EOF
deployment.apps/nginx-deployment created
</code></pre></div><h2 id=a-use-case-example>A use case example</h2><p>Let&rsquo;s see how users can enforce that their resources have a minimum set of required environment variables. For that, it possible to use the <code>allAreUsed</code> operator:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl apply -f - &lt;&lt;EOF
apiVersion: policies.kubewarden.io/v1
kind: ClusterAdmissionPolicy
metadata:
  name: environment-variable-policy
spec:
  module: ghcr.io/kubewarden/policies/environment-variable-policy:v0.1.1
  mutating: false
  rules:
  - apiGroups: [&#34;apps&#34;]
    apiVersions: [&#34;v1&#34;]
    resources: [&#34;deployments&#34;]
    operations:
    - CREATE
    - UPDATE
  settings:
    rules:
      - reject: anyIn
        environmentVariables:
          - name: &#34;foo&#34;
            value: &#34;bar&#34;
          - name: &#34;foo2&#34;
            value: &#34;bar2&#34;

EOF
</code></pre></div><p>With the above policy only resources that have <strong>all</strong> the variables defined in the <code>environmentVariables</code> field will be allowed.</p><p>Now try to deploy a resource that violates that rule:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>kubectl apply -f - &lt;&lt;EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: template-nginx
  template:
    metadata:
      labels:
        app: template-nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.14.2
        ports:
        - containerPort: 80
        env:
          - name: &#34;foo&#34;
            value: &#34;bar&#34;
EOF
Error from server: error when creating &#34;STDIN&#34;: admission webhook &#34;clusterwide-environment-variable-policy.kubewarden.admission&#34; denied the request: Resource cannot define any of the environment variables from the rule.
</code></pre></div><h2 id=summary>Summary</h2><p>We hope this article provided you a nice overview about the potential use cases of this policy and how to use it.
Give it a try and, as usual, we look forward to your feedback :).</p><p>Have ideas for new policies? Would you like more features on existing ones?
Drop us a line at <a href=https://kubernetes.slack.com/archives/C01T3GTC3L7>#kubewarden on Slack</a>!</p></div><div><ul id=tags></ul></div><div></div></article></section></main><footer><p>&copy; 2023 Kubewarden Project Authors. All rights reserved.
The Linux Foundation has registered trademarks and uses trademarks.
For a list of trademarks of The Linux Foundation, please see our Trademark Usage page:
<a href=https://www.linuxfoundation.org/trademark-usage>https://www.linuxfoundation.org/trademark-usage</a></p><div class=project-icons><a href=https://k3s.io target=blank><img src=/images/icon-k3s.svg height=20></a>
<a href=https://harvesterhci.io target=blank><img src=/images/icon-harvester.svg height=20></a>
<a href=https://rancherdesktop.io target=blank><img src=/images/icon-rancher-desktop.svg height=20></a>
<a href=https://epinio.io target=blank><img src=/images/icon-epinio.svg height=20></a>
<a href=https://hypper.io target=blank><img src=/images/icon-hypper.svg height=20></a></div></footer><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-56382716-13','auto'),ga('set','anonymizeIp',!0),ga('send','pageview'))</script></body></html>