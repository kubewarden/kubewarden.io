<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Beyond Prefix Matching</title><link rel=icon type=image/svg href=/favicon.svg><link rel=mask-icon href=/favicon.svg><link rel=stylesheet type=text/css href=/sass/blog.min.css?1740585260><script async defer src=https://buttons.github.io/buttons.js></script><script type=text/javascript src=//cdn.bizible.com/scripts/bizible.js async></script></head><body><header><div class=sub-header><a href><img src=/images/logo-kubewarden.svg alt=Kubewarden></a>
<a href=#main-menu id=main-menu-toggle class=menu-toggle aria-label="Open main menu"><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a><nav id=main-menu class=main-menu aria-label="Main menu"><a href=#main-menu-toggle id=main-menu-close class=menu-close aria-label="Close main menu"><span class=sr-only>Close main menu</span>
<span class="fa fa-close" aria-hidden=true></span></a><h2 id=main-menu-heading class=sr-only>Main menu</h2><ul class=menu><li><a href="https://artifacthub.io/packages/search?kind=13&sort=relevance&page=1" target=_blank class="btn no-bg">Policies</a></li><li><a href=https://charts.kubewarden.io/ target=_blank class="btn no-bg">Helm Charts</a></li><li><a href=https://docs.kubewarden.io/ target=_blank class="btn no-bg">Docs</a></li><li><a href="https://kubernetes.slack.com/?redir=%2Fmessages%2Fkubewarden" target=_blank class="btn no-bg">Slack</a></li><li><a href=https://bsky.app/profile/kubewarden.io target=_blank class="btn no-bg">Bluesky</a></li><li><a href=https://hachyderm.io/@kubewarden rel=me target=_blank class="btn no-bg">Mastodon</a></li><li><a href=/#get-in-touch target=_blank class="btn no-bg">Community</a></li><li><a href=/blog target=_blank class="btn no-bg">Blog</a></li><li><a href=https://github.com/kubewarden class="btn github"><img src=/images/icon-github.svg><span>Github</span></a></li></ul></nav><a href=#main-menu-toggle class=backdrop tabindex=-1 aria-hidden=true hidden></a></div></header><link rel=stylesheet href=/css/blog.css><section class=intro><div class=bg-primary><div class="wrap grid-one"><div><h1 style=color:#fff><a href=/blog>The Kubewarden blog</a>
<a href=/blog/index.xml><img src=/images/icon-rss.svg class=fill-white height=20></a></h1></div></div></div></section><main><section class=wrap><article><h1>Beyond Prefix Matching</h1><p>Author: <author>Flavio Castelli, Nuno do Carmo and VÃ­ctor Cuadrado Juan</author></p><p>Published: <time>19 Feb 2025</time></p><p>Updated: <time>26 Feb 2025</time></p><div id=blog-post-content><p>A recent <a href=https://www.aquasec.com/blog/risks-misconfigured-kubernetes-policy-engines-opa-gatekeeper/>Aqua Security blog</a> post highlighted
the risks of misconfigured Kubernetes policy engines, particularly when dealing with OPA Gatekeeper.
The post correctly points out the challenges of managing complex policies and the potential for bypasses due to misconfigurations.
However, it also underscores a critical limitation of many policy engines: their reliance on string manipulation, especially when dealing with OCI image references.
This is where Kubewarden takes a different, and significantly more robust, approach.</p><h2 id=the-challenge-accurately-handling-oci-image-references>The Challenge: Accurately Handling OCI Image References</h2><p>The Aqua blog mentions common misconfigurations, many of which stem from the difficulty of accurately matching image names. Prefix matching and regular expressions are often used,
but as the blog hints, these methods fall short when handling the intricacies of the OCI (Open Container Initiative) specification. The OCI registry naming scheme is complex,
with numerous edge cases that are difficult, if not impossible, to capture reliably with simple string operations.
Trying to approximate the OCI spec with regular expressions is a recipe for potential vulnerabilities.</p><h2 id=kubewardens-solution-real-code-for-real-problems>Kubewarden&rsquo;s Solution: Real Code for Real Problems</h2><p>This is where Kubewarden shines. Unlike other policy engines that rely on string manipulation, Kubewarden executes real code.
Specifically, Kubewarden leverages a Rust library that performs OCI reference parsing according to the official specification.
This crucial difference eliminates the guesswork and inherent inaccuracies of string-based approaches.
Instead of trying to approximate the OCI spec with regular expressions, Kubewarden uses the spec itself to ensure accurate and reliable image name validation.</p><h2 id=a-practical-example-the-trusted-repos-policy>A Practical Example: The trusted-repos Policy</h2><p>Consider a real-world example: the <a href=https://github.com/kubewarden/trusted-repos-policy>trusted-repos</a> policy within the Kubewarden project.
This policy doesn&rsquo;t rely on prefix matching. Instead, it checks against a provided set of trusted repositories.</p><p>The code, available on GitHub <a href=https://github.com/kubewarden/trusted-repos-policy/blob/main/src/validation.rs#L99-L104>here</a>,
demonstrates how the .registry component of the image reference is extracted and validated. This extraction is performed using the aforementioned Rust library,
ensuring adherence to the OCI spec and avoiding the pitfalls of string-based approximations.</p><h2 id=the-kubewarden-advantage-accuracy-reliability-and-maintainability>The Kubewarden Advantage: Accuracy, Reliability, and Maintainability</h2><p>Kubewarden&rsquo;s approach offers several key advantages:</p><ul><li><strong>Unmatched Accuracy:</strong> By using a dedicated OCI library, Kubewarden ensures accurate parsing and validation of image references, eliminating the risk of
bypasses due to misconfigured regular expressions or incorrect prefix matching.</li><li><strong>Superior Reliability:</strong> Because Kubewarden uses the official OCI spec, it&rsquo;s far more reliable than solutions that attempt to recreate the spec with string manipulation.
This translates to more secure and predictable policy enforcement.</li><li><strong>Improved Maintainability:</strong> Instead of wrestling with complex regular expressions, Kubewarden policies can be written with clear, concise code that leverages the OCI library.
This makes policies easier to understand, maintain, and debug.</li><li><strong>Conclusion:</strong> Embrace Real Code for Kubernetes Security</li></ul><p>In short, while other policy engines struggle with the complexities of OCI image naming, Kubewarden offers a clean, robust, and accurate solution.
By executing real code and adhering to the official OCI specification, Kubewarden provides a level of security and reliability that string-based approaches simply can&rsquo;t match.
If you&rsquo;re serious about Kubernetes security, it&rsquo;s time to move beyond prefix matching and embrace the power of real code with Kubewarden.</p></div><div><ul id=tags></ul></div><div></div></article></section></main><footer><p>&copy; 2025 Kubewarden Project Authors. All rights reserved.
The Linux Foundation has registered trademarks and uses trademarks.
For a list of trademarks of The Linux Foundation, please see our Trademark Usage page:
<a href=https://www.linuxfoundation.org/trademark-usage>https://www.linuxfoundation.org/trademark-usage</a></p></footer><script async src="https://www.googletagmanager.com/gtag/js?id=G-PSW07XK7TM"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-PSW07XK7TM',{anonymize_ip:!0})}</script></body></html>